(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[91312],{291312:(e,t,r)=>{"use strict";r.d(t,{ou:()=>V,SN:()=>te,ZP:()=>oe,RX:()=>ee,jh:()=>re,T$:()=>W,id:()=>ne});var n={};r.r(n),r.d(n,{createCategory:()=>Y,createResource:()=>X,deleteResource:()=>F,getResource:()=>x,getResourceDataByName:()=>$,getResourceIdByName:()=>_,getResources:()=>q,searchListByAttributes:()=>G,updateResource:()=>z,updateResourceAttribute:()=>H});var o=r(49977),u=r(423570),i=r.n(u),a=r(264721),c=r.n(a),s=r(414293),f=r.n(s),l=r(957557),b=r.n(l),v=r(701469),d=r.n(v),p=r(513218),g=r.n(p),m=r(227361),y=r.n(m),h=r(313311),O=r.n(h),R=r(849843),A=r(913718);function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){k(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function k(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==w(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!==w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"===w(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function S(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,u,i,a=[],c=!0,s=!1;try{if(u=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=u.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(e){s=!0,o=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(s)throw o}}return a}}(e,t)||D(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||D(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){if(e){if("string"==typeof e)return M(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?M(e,t):void 0}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Z,B=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"rest/geostore/data/".concat(e).concat(t)},N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.Z;return o.Observable.defer((function(){return r.getResourceAttributes(e)})).map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.name;return t(r)})).map((function(e){var t=e.value;return(0,A.C)(t)})).filter((function(e){return!f()(e)}))}))},I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.concat(t)},L=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.Z;return t?o.Observable.defer((function(){return r.updateResourcePermissions(e,{SecurityRuleList:{SecurityRule:t}})})):o.Observable.empty()},J=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return"NODATA"===r.data?o.Observable.fromPromise(i.deleteResource(n)).catch((function(){return o.Observable.of("DUMMY")})).switchMap((function(){return o.Observable.fromPromise(i.updateResourceAttribute(e,t,"NODATA"))})):o.Observable.forkJoin([o.Observable.defer((function(){return i.putResource(n,r.data)})).switchMap((function(){return o.Observable.defer((function(){return i.updateResourceAttribute(e,t,B(n,r.tail))}))}))].concat(C(u?[L(n,u,i)]:[])))},E=function(e,t,r,n){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:R.Z;return"NODATA"!==r.data?o.Observable.defer((function(){return u.createResource({name:"".concat(e,"-").concat(t,"-").concat(i()())},r.data,r.category)})).pluck("data").switchMap((function(i){return o.Observable.forkJoin([o.Observable.defer((function(){return u.updateResourceAttribute(e,t,B(i,r.tail))}))].concat(C(n?[L(i,n,u)]:[]))).map((function(){return i}))})):o.Observable.of(-1)},T=function(e,t,r,n){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:R.Z;return o.Observable.defer((function(){return u.getResourceAttributes(e)})).switchMap((function(o){var i,a=null===(i=O()(o,{name:t}))||void 0===i?void 0:i.value;return(0,A.C)(a)?J(e,t,r,(0,A.C)(a),n,u):E(e,t,r,n,u)})).catch((function(o){return E(e,t,r,n,u,o)}))},U=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R.Z;return N(e,(function(e){return!c()(Object.keys(t),e)})).switchMap((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return 0===e.length?o.Observable.of([]):o.Observable.forkJoin(e.map((function(e){return L(e,r,n)})))}))},x=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.includeAttributes,n=void 0===r||r,u=t.withData,i=void 0===u||u,a=t.withPermissions,c=void 0!==a&&a,s=t.baseURL,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.Z;return o.Observable.forkJoin([o.Observable.defer((function(){return f.getShortResource(e)})).pluck("ShortResource"),o.Observable.defer((function(){return n?f.getResourceAttributes(e):new Promise((function(e){return e([])}))}))].concat(C(i?[o.Observable.defer((function(){return f.getData(e,{baseURL:s})}))]:[]),C(c?[o.Observable.defer((function(){return f.getResourcePermissions(e,{},!0)}))]:[]))).map((function(e){var t=S(e,4),r=t[0],n=t[1],o=t[2],u=t[3];return P(P({},r),{},{attributes:(n||[]).reduce((function(e,t){return P(P({},e),{},k({},t.name,t.value))}),{}),data:o,permissions:u})}))},_=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.Z;return o.Observable.defer((function(){return r.getResourceIdByName(e,t)}))},$=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.Z;return o.Observable.defer((function(){return r.getResourceDataByName(e,t)}))},q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.query,r=void 0===t?"*":t,n=e.category,u=e.options,i=void 0===u?{params:{start:0,limit:10},includeAttributes:!1,withData:!1,withPermission:!1}:u,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.Z;return o.Observable.defer((function(){return a.getResourcesByCategory(n,r,i)})).map((function(e){var t=e.results,r=void 0===t?[]:t,n=e.totalCount,o=void 0===n?0:n,u=i.includeAttributes,c=i.withData,s=i.withPermission;return u||c||s?{totalCount:o,results:r.map((function(e){var t=e.id;return x(t,i,a)}))}:{totalCount:o,results:r}}))},X=function(e){var t=e.data,r=e.category,n=e.metadata,u=e.permission,i=e.linkedResources,a=void 0===i?{}:i,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.Z;return o.Observable.defer((function(){return c.createResource(n,t,r)})).pluck("data").switchMap((function(e){return o.Observable.defer((function(){return c.getResourcePermissions(e)})).map((function(e){return I(e,u)})).switchMap((function(t){return L(e,t,c).map((function(){return{id:e,permission:t}}))}))})).switchMap((function(e){var t=e.id,r=e.permission;return Object.keys(a).length>0?o.Observable.forkJoin(Object.keys(a).filter((function(e){return a[e].data&&"NODATA"!==a[e].data})).map((function(e){return E(t,e,a[e],r,c)}))).map((function(){return t})):o.Observable.of(t)}))},Y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.Z;return o.Observable.defer((function(){return t.createCategory(e)}))},z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id,r=e.data,n=e.permission,u=e.metadata,i=e.linkedResources,a=void 0===i?{}:i,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.Z,s=Object.keys(a);return o.Observable.forkJoin([o.Observable.defer((function(){return c.putResourceMetadataAndAttributes(t,u)})).switchMap((function(e){return r?o.Observable.defer((function(){return c.putResource(t,r)})):o.Observable.of(e)})).switchMap((function(e){return n?o.Observable.defer((function(){return L(t,n,c)})):o.Observable.of(e)})),(s.length>0?o.Observable.forkJoin.apply(o.Observable,C(s.map((function(e){return T(t,e,a[e],n,c)})))):o.Observable.of([])).switchMap((function(){return n?o.Observable.defer((function(){return U(t,a,n,c)})):o.Observable.of(-1)}))]).map((function(){return t}))},F=function(e){var t=e.id,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.deleteLinkedResources,u=void 0===n||n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.Z;return(u?N(t,(function(){return!0}),i):o.Observable.of([])).map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return o.Observable.forkJoin([t].concat(C(e)).map((function(e){return i.deleteResource(e)})))}))},G=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.Z;return o.Observable.defer((function(){return r.searchListByAttributes(e,t)})).switchMap((function(e){if(!e||!y()(e,"ExtResourceList.Resource"))return o.Observable.of({results:[],totalCount:0});var n=y()(e,"ExtResourceList.Resource",[]),u=(d()(n)?n:[n]).map((function(e){return P(P({},b()(e,"Attributes")),{},{attributes:(t=e,r=y()(t,"Attributes.attribute"),n=d()(r)&&r||g()(r)&&[r],n&&n.reduce((function(e,t){return P(P({},e),{},k({},t.name,t.value))}),{})||{})});var t,r,n}));return(t.withPermissions?o.Observable.forkJoin(u.map((function(e){return o.Observable.defer((function(){return r.getResourcePermissions(e.id,{},!0)})).map((function(t){return P(P({},e),{},{permissions:t})}))}))):o.Observable.of(u)).map((function(t){return{results:t,totalCount:y()(e,"ExtResourceList.ResourceCount")}}))}))},H=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id,r=e.name,n=e.value,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.Z;return o.Observable.defer((function(){return u.updateResourceAttribute(t,r,n)})).switchMap((function(){return o.Observable.of(t)}))},K=r(737275),Q={geostore:n},V=function(e,t){Q[e]=t},W=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"geostore";Z.api=e},ee=function(){var e;return(e=Z.getApi()).getResource.apply(e,arguments)},te=function(){var e;return(e=Z.getApi()).createResource.apply(e,arguments)},re=function(){var e;return(e=Z.getApi()).getResources.apply(e,arguments)},ne=function(){var e;return(e=Z.getApi()).updateResource.apply(e,arguments)};const oe=Z={api:"geostore",addApi:V,setApi:W,getApi:function(){return Q[K.ZP.getConfigProp("persistenceApi")||Z.api]},getResource:ee,getResourceIdByName:function(){var e;return(e=Z.getApi()).getResourceIdByName.apply(e,arguments)},getResourceDataByName:function(){var e;return(e=Z.getApi()).getResourceDataByName.apply(e,arguments)},createResource:te,createCategory:function(){var e;return(e=Z.getApi()).createCategory.apply(e,arguments)},getResources:re,updateResource:ne,updateResourceAttribute:function(){var e;return(e=Z.getApi()).updateResourceAttribute.apply(e,arguments)},deleteResource:function(){var e;return(e=Z.getApi()).deleteResource.apply(e,arguments)},searchListByAttributes:function(){var e;return(e=Z.getApi()).searchListByAttributes.apply(e,arguments)}}},913718:(e,t,r)=>{"use strict";r.d(t,{C:()=>o});var n=/rest\/geostore\/data\/(\d+)/,o=function(e){var t=decodeURIComponent(decodeURIComponent(e)),r=n.exec(t);return r&&!!r[0]&&r[1]}}}]);